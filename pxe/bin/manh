#!/bin/sh
# backuPXE - Copyright (C) 2006-2019 Luc Deschenaux, all rights reserved.
#
# This program is free software: you can redistribute it and/or modify
# it under the terms of the GNU Affero General Public License as
# published by the Free Software Foundation, either version 3 of the
# License, or (at your option) any later version.

# This program is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU Affero General Public License for more details.

# You should have received a copy of the GNU Affero General Public License
# along with this program.  If not, see <http://www.gnu.org/licenses/>.


set -e

BROWSER=lynx
TMP=/tmp/manh.`date +%Y%m`

if ( echo $1 | egrep -q "^[0-9]+$" ) ; then
	HTMLVERSION=$1
	shift
else
	HTMLVERSION=401
fi

ELEMENTS=http://www.w3.org/TR/html$HTMLVERSION/index/elements.html

if [ ! -f "$TMP" ] ; then

	if ! wget -q $ELEMENTS  -O $TMP ; then
		echo cannot download $ELEMENTS
		exit 1
	fi

        sed -r -n -e 's/.*<td title="Name"><a href="([^"]+)">([^<]+)<\/a><\/td>.*/\2\t\1/p' $TMP > $TMP.tmp

	mv $TMP.tmp $TMP
fi

urltail=`egrep -i "^$1[^A-Z]" $TMP | cut -f 2`
if [ -z "$urltail" ] ; then
	echo $1: man page not found
	exit 1
fi

$BROWSER `dirname $ELEMENTS`/$urltail
echo `dirname $ELEMENTS`/$urltail
